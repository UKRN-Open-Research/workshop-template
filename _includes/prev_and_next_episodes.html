{% comment %}
    This file determines the previous and next episodes
    relative to the current episode.
    These variables are exposed as previous_episode and next_episode
{% endcomment %}

{% assign previous_episode = nil %}
{% assign next_episode = nil %}

{% assign next_is_now = false %}
{% assign last_episode = nil %}
{% assign EPISODES = site.episodes | concat: site.episodes_rmd %}
{% assign days = EPISODES | sort: 'day' | map: 'day' %}
{% for day in days %}
    {% if day >= 1 %}
        {% assign day_episodes = EPISODES | where: "day", day %}
        {% assign episodes = day_episodes | sort: 'order' %}
        {% for episode in episodes %}
            {% if next_is_now == true %}
                {% assign next_episode = episode %}
                {% break %}
            {% endif %}
            {% if episode.url == page.url %}
                {% assign previous_episode = last_episode %}
                {% assign next_is_now = true %}
            {% endif %}
            {% assign last_episode = episode %}
        {% endfor %}
        {% if previous_episode and next_episode %}
            {% break %}
        {% endif %}
    {% endif %}
{% endfor %}
